{% extends 'base.html' %}

{% block head %}
<title>Update Channels - {{ site.site_name.replace('_', ' ') }}</title>
<script>
// on color select, change background color to match selection
function change_bg_color(id, color) {
    color_selector = document.getElementById(id)
    if (!color) {
        color = color_selector.value
    }
    color_selector.style.backgroundColor = color
}
</script>
{% endblock %}

{% block body %}
<div class="container" id="header">
    <h1>Update Channels</h1>
    <h2 style="margin-top:10px">{{ site.site_name.replace('_', ' ') }}</h2>
    {% for message in get_flashed_messages() %}
        <br><p style="font-weight:bolder;">{{ message }}</p>
    {% endfor %}
</div>

<div class="container config_form">
    <form action="#" id="box" method="POST">
        {% for channel in site.channels %}
        {% set channel_order = (channel.channel_order + 1)|string %}
        {% set id = "existing_" ~ channel.id %}
        <fieldset id="{{channel.id}}">
          <dl>
            <div class="channel_header">
                <label id="{{channel_order}}" style="float:left; margin:0;">{{channel_order}}.</label>
                <label id='{{id}}_header'>{{channel.title}}</label>
                <img class="hide_content_button" id="{{id}}_hide_content"
                onclick="maximize_channel_data('{{id}}'); return false;" src='/static/img/plus_sign.png' alt='+'>
                <input type="hidden" id="{{id}}_chan_type" name="{{id}}_chan_type" value="{{channel.chan_type}}">
            </div>


        {% if channel.chan_type == 'meter' %}
        {% set meter_config = channel.meter_config[0] %}
            <dt id='{{id}}_content' class="config_content top-border" style="display: none;">
                <label for='{{id}}_title' class="title-margin">Title</label>
                <input type="text" id='{{id}}_title' name='{{id}}_title' value="{{channel.title}}" required>
                <label for="{{id}}_burk_channel">Burk Channel Number</label><br>
                <input type="number" id="{{id}}_burk_channel" name="{{id}}_burk_channel"
                       value="{{meter_config.burk_channel}}" required>

                <label for="{{id}}_nominal_output">Nominal Output</label><br>
                <input id="{{id}}_nominal_output" name="{{id}}_nominal_output"
                       type="number" step="any" required
                       value="{{meter_config.nominal_output}}">
            <h4 style="margin:0;">Limits</h4>
            <div class="option_box">
                <label for="{{id}}_upper_limit">Upper Limit</label><br>
                <input id="{{id}}_upper_limit" name="{{id}}_upper_limit"
                       type="number" step="any" value="{{meter_config.upper_limit}}">

                <label>
                Color above upper limit
                <select style="background-color: {{meter_config.upper_lim_color}}"
                        id="{{id}}_upper_lim_color" name="{{id}}_upper_lim_color"
                        onchange="change_bg_color('{{id}}_upper_lim_color')" required>
                    <option></option>
                    {% for color in colors %}
                    <option style="background-color: {{color.hex}}" value="{{ color.hex }}"
                    {% if meter_config.upper_lim_color == color.hex %} selected {% endif %}>
                        {{ color.name }}
                    </option>
                    {% endfor %}
                </select>
                </label>

                <label for="{{id}}_lower_limit">Lower Limit</label><br>
                <input id="{{id}}_lower_limit" name="{{id}}_lower_limit"
                       type="number" step="any" value="{{meter_config.lower_limit}}">

                <label>
                Color below lower limit
                <select style="background-color: {{meter_config.lower_lim_color}}"
                        id="{{id}}_lower_lim_color" name="{{id}}_lower_lim_color"
                        onchange="change_bg_color('{{id}}_lower_lim_color')" required>
                    <option></option>
                    {% for color in colors %}
                    <option style="background-color: {{color.hex}}" value="{{ color.hex }}"
                    {% if meter_config.lower_lim_color == color.hex %} selected {% endif %}>
                        {{color.name}}
                    </option>
                    {% endfor %}
                </select>
                </label>
            </div>
              <div class="config_content">
                <label style="" for="{{id}}_units">Units: </label>
                <select style="" id="{{id}}_units" name="{{id}}_units">
                    <option></option>
                    {% for unit_type in units %}
                    <option value="{{unit_type}}"
                    {% if meter_config.units == unit_type %} selected {%endif%}>
                        {{unit_type}}
                    </option>
                    {% endfor %}
                </select>
              </div>
              <button class="func_button" onclick="add_delete_channel_tag('{{channel.id}}'); return false">
                    DELETE CHANNEL
              </button>
            </dt>

        {% elif channel.chan_type == 'status' %}
        {% set options = channel.status_options %}
        {% set opt_count = options|length %}
            <dt id='{{id}}_content' class="config_content top-border" style="display: none">
                <label for='{{id}}_title' class="title-margin">Title</label>
                <input type="text" id='{{id}}_title' name='{{id}}_title' value="{{channel.title}}" required>
                <input type="hidden" id="{{id}}_opt_count" name="{{id}}_opt_count" value="{{opt_count}}">
                <div id="{{id}}_options">
                    {% for option in options %}
                    {% set i = loop.index %}
                    <div class="option_box" id="{{id}}_option_{{i}}">
                        <h4 style="text-decoration: underline; margin:0;">Option {{i}}</h4>

                        <label>Burk Channel Number</label>
                        <input id="{{id}}_burk_channel_{{i}}" name="{{id}}_burk_channel_{{i}}"
                               type="number" value="{{option.burk_channel}}">

                        <label>Option Name</label>
                        <input id="{{id}}_selected_value_{{i}}" name="{{id}}_selected_value_{{i}}"
                               type="text" value="{{option.selected_value}}">

                        <label>
                        Selected State
                        </label>
                        <div class="radio_group option_radio_group">
                            <label style="margin-right:25px;">
                            <input type="radio" name="{{id}}_selected_state_{{i}}" value=true
                            {% if option.selected_state %} checked="checked" {% endif %} required>
                                On
                            </label>

                            <label>
                            <input type="radio" name="{{id}}_selected_state_{{i}}" value=false
                            {% if not option.selected_state %} checked="checked" {% endif %}>
                                Off
                            </label>
                        </div>

                        <label>
                        Background Color When Selected
                        </label>
                        <select id="{{id}}_selected_color_{{i}}" name="{{id}}_selected_color_{{i}}"
                                style="background-color: {{option.selected_color}};"
                                onchange="change_bg_color('{{id}}_selected_color_{{i}}')" required>
                        <option></option>
                        {% for color in colors %}
                        <option style="background-color: {{color.hex}}" value="{{ color.hex }}"
                        {% if option.selected_color == color.hex %} selected {% endif %}>
                            {{ color.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                {% endfor %}
                </div>
                <button class="func_button" onclick="add_next_option('{{id}}'); return false;">Add Option</button>
                <button class="func_button" onclick="add_delete_channel_tag('{{channel.id}}'); return false">
                    DELETE CHANNEL
                </button>
            </dt>
        {% endif %}
            </dl>
        </fieldset>
        {% endfor %}

         <fieldset>
            <input type="hidden" name="channel_count" id="channel_count" value="{{site.channels|length}}">
            <dl>
                <dt>
                    <div id="add_channel">
                        <button class="func_button" onclick="add_channel_selector_html(); return false;">Add Channel</button>
<!--                Button replaced with channel type selector and submit    -->
                    </div>
                </dt>
            </dl>
        </fieldset>

        <div id="channels">
<!--    Channel HTML added here each time Add Channel button finishes submission -->
        </div>


        <button style="width:100%; border:0px; margin-bottom:0px" type="submit" value="Submit">SUBMIT</button>
    </form>
</div>
<script src="{{ url_for('static', filename='javascript/add_channel_html.js') }}"></script>
<script>
    window.onload = function () {
        channel_count.value = {{site.channels|length}}
    }
</script>
{% endblock %}